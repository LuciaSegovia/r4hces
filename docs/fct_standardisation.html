<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for Household Consumption and Expenditure Surveys - 8&nbsp; Food Composition Table &amp; Databases: Standardisation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./hcesNutR-package.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Food Composition Table &amp; Databases: Standardisation</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Household Consumption and Expenditure Surveys</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://dzvoti.github.io/hces4R/hces-datazip" title="" class="sidebar-tool px-1"><i class="bi bi-cloud-arrow-down"></i></a>
    <a href="https://github.com/dzvoti/mapsNutritionR/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_types.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Structures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages_and_functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Packages and Functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_wrangling_and_io.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data I/O and Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_visualisation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Visualisation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hcesNutR-package.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>hcesNutR</code> Package</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fct_standardisation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Food Composition Table &amp; Databases: Standardisation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">summary.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objective" id="toc-objective" class="nav-link active" data-scroll-target="#objective"><span class="toc-section-number">8.1</span>  Objective</a></li>
  <li><a href="#environment-prep" id="toc-environment-prep" class="nav-link" data-scroll-target="#environment-prep"><span class="toc-section-number">9</span>  Environment Prep</a>
  <ul class="collapse">
  <li><a href="#food-composition-functions" id="toc-food-composition-functions" class="nav-link" data-scroll-target="#food-composition-functions"><span class="toc-section-number">9.1</span>  Food composition functions</a></li>
  </ul></li>
  <li><a href="#obtaining-the-raw-fct-files-for-importing" id="toc-obtaining-the-raw-fct-files-for-importing" class="nav-link" data-scroll-target="#obtaining-the-raw-fct-files-for-importing"><span class="toc-section-number">10</span>  Obtaining the raw (FCT) file(s) for importing</a>
  <ul class="collapse">
  <li><a href="#data-license-check" id="toc-data-license-check" class="nav-link" data-scroll-target="#data-license-check"><span class="toc-section-number">10.1</span>  Data License Check</a></li>
  <li><a href="#data-download" id="toc-data-download" class="nav-link" data-scroll-target="#data-download"><span class="toc-section-number">10.2</span>  Data Download</a></li>
  <li><a href="#file-names-conventions" id="toc-file-names-conventions" class="nav-link" data-scroll-target="#file-names-conventions"><span class="toc-section-number">10.3</span>  File names conventions</a></li>
  </ul></li>
  <li><a href="#importing-the-data-loading-the-data" id="toc-importing-the-data-loading-the-data" class="nav-link" data-scroll-target="#importing-the-data-loading-the-data"><span class="toc-section-number">11</span>  Importing the data (loading the data)</a>
  <ul class="collapse">
  <li><a href="#identifying-the-file" id="toc-identifying-the-file" class="nav-link" data-scroll-target="#identifying-the-file"><span class="toc-section-number">11.1</span>  Identifying the file</a>
  <ul class="collapse">
  <li><a href="#using-the-download-code-above-1.2." id="toc-using-the-download-code-above-1.2." class="nav-link" data-scroll-target="#using-the-download-code-above-1.2."><span class="toc-section-number">11.1.1</span>  Using the download code above (1.2.)</a></li>
  <li><a href="#using-herehere" id="toc-using-herehere" class="nav-link" data-scroll-target="#using-herehere"><span class="toc-section-number">11.1.2</span>  Using here::here()</a></li>
  </ul></li>
  <li><a href="#importing-files" id="toc-importing-files" class="nav-link" data-scroll-target="#importing-files"><span class="toc-section-number">11.2</span>  Importing Files</a>
  <ul class="collapse">
  <li><a href="#importing-.xlsx-files" id="toc-importing-.xlsx-files" class="nav-link" data-scroll-target="#importing-.xlsx-files"><span class="toc-section-number">11.2.1</span>  Importing .xlsx files</a></li>
  <li><a href="#importing-.csv-files" id="toc-importing-.csv-files" class="nav-link" data-scroll-target="#importing-.csv-files"><span class="toc-section-number">11.2.2</span>  Importing .csv files</a></li>
  </ul></li>
  <li><a href="#checking-the-loaded-data" id="toc-checking-the-loaded-data" class="nav-link" data-scroll-target="#checking-the-loaded-data"><span class="toc-section-number">11.3</span>  Checking the loaded data</a></li>
  <li><a href="#how-many-rows-columns-have-the-data" id="toc-how-many-rows-columns-have-the-data" class="nav-link" data-scroll-target="#how-many-rows-columns-have-the-data"><span class="toc-section-number">11.4</span>  How many rows &amp; columns have the data?</a></li>
  <li><a href="#what-are-the-variables-names" id="toc-what-are-the-variables-names" class="nav-link" data-scroll-target="#what-are-the-variables-names"><span class="toc-section-number">11.5</span>  What are the variables names?</a></li>
  </ul></li>
  <li><a href="#data-formatting" id="toc-data-formatting" class="nav-link" data-scroll-target="#data-formatting"><span class="toc-section-number">12</span>  Data Formatting</a>
  <ul class="collapse">
  <li><a href="#visually-checking-the-data" id="toc-visually-checking-the-data" class="nav-link" data-scroll-target="#visually-checking-the-data"><span class="toc-section-number">12.1</span>  Visually checking the data</a></li>
  <li><a href="#trimming-dataframe-rows" id="toc-trimming-dataframe-rows" class="nav-link" data-scroll-target="#trimming-dataframe-rows"><span class="toc-section-number">12.2</span>  Trimming dataframe rows</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/dzvoti/mapsNutritionR/edit/main/fct_standardisation.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Food Composition Table &amp; Databases: Standardisation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="objective" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="objective"><span class="header-section-number">8.1</span> Objective</h2>
<p>This document provide, together with the template document, the steps and description for cleaning and standardising FCTs from diverse sources. More details about the cleaned data that can be found in the repository is documented in this folder (documentation).</p>
<p>For easy navigation and use of this script it is recommended to use Rstudio. In RStudio please click the “Show Document Outline” button to the right of the source button, at the top right of this window. This will allow for easier navigation of the script.</p>
</section>
<section id="environment-prep" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Environment Prep</h1>
<p>First we need to check what <a href="link-to-packages-explanation">packages</a> are installed. If you have run this template before in this RStudio project and are sure these packages are already installed, you can comment out (put a hash at the start of) line 20, and skip it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"readxl"</span>, <span class="st">"stringr"</span>, <span class="st">"dplyr"</span>, <span class="st">"here"</span>, <span class="st">"measurements"</span>) <span class="co">#This line lists the required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">setdiff</span>(required_packages, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>()))) <span class="co">#This installs them if they aren't already installed.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(required_packages, library, <span class="at">character.only=</span><span class="cn">TRUE</span>) <span class="co">#And then activates them</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, run this to clean the environment</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="food-composition-functions" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="food-composition-functions"><span class="header-section-number">9.1</span> Food composition functions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We also need to import some custom functions in another script:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"functions.R"</span>)) <span class="co"># Loading nutrition functions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="obtaining-the-raw-fct-files-for-importing" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Obtaining the raw (FCT) file(s) for importing</h1>
<section id="data-license-check" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="data-license-check"><span class="header-section-number">10.1</span> Data License Check</h2>
<p>Before using any dataset, we recommend to check licensing conditions &amp; record the data source, you can use the <a href="link-to-readme-template">README template</a>.</p>
</section>
<section id="data-download" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="data-download"><span class="header-section-number">10.2</span> Data Download</h2>
<p>If the data is publicly available online, usually you only need to run the code below to obtain the raw files. Remember you only need to do it the first time! Then, the data will be stored in the folder of your choice (see below).</p>
<p>For instance, many raw files can be found provided by the FAO here, in various formats - https://www.fao.org/infoods/infoods/tables-and-databases/en/</p>
<p>Once the link to the data is found, check what file type it is, and paste the direct file link to replace the fill-in value below.</p>
<p>Please note: in the chunck of code below, the ‘template’ is a fill in value for a folder - if you wish to store this file in a folder, you must create a folder in your here::here location (found by running <code>here::here()</code>) and replace ‘template’ with that folders name. It is also important to make sure that the filename you pick for the downloaded file has the same file suffix (e.g.&nbsp;‘.xlsx’) as the file you are downloading.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"http://www.the-source-of-the-data/.../the-file-data.xlsx"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(f,  <span class="co"># the location where is downloaded from </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'template'</span>, <span class="st">"the-file-name-of-data.xlsx"</span>), <span class="co"># the location where you                                                 wish the file to be stored in your computer. </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span><span class="st">"wininet"</span>, <span class="co"># use "curl" for OS X / Linux, "wininet" for Windows </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode=</span><span class="st">"wb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="file-names-conventions" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="file-names-conventions"><span class="header-section-number">10.3</span> File names conventions</h2>
<p>We advise to use the ISO code (2 digits) (see <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">ISO 3166 2-alpha code</a> for further information) of the country or the region of the FCT scope, plus the two last digits of the year of publication to name, both the folder which will contain the data and the scripts related to the FCT. For instance, Kenya FCT, 2018 will be coded as KE18. This will help with the interoperability, reusability and findability of the data. Also, to streamline the work in the future. That name convention will be used also as the identifier of the FCT. See section X.x. Variable re-naming.</p>
</section>
</section>
<section id="importing-the-data-loading-the-data" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Importing the data (loading the data)</h1>
<section id="identifying-the-file" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="identifying-the-file"><span class="header-section-number">11.1</span> Identifying the file</h2>
<section id="using-the-download-code-above-1.2." class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="using-the-download-code-above-1.2."><span class="header-section-number">11.1.1</span> Using the download code above (1.2.)</h3>
<p>First, we must find the file on your system that we want to import. If using RStudio: If you used the download method above <a href="link-to-section">Section 1.2</a> then we will see the same location as specified there to specify the file. Simply copy the contents of the here::here brackets and use it to fill the here::here brackets in the line of code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This identifies the file and file path, and saves it as a variable</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>FCT_file_location <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'template'</span>, <span class="st">"the-file-name-of-data.xlsx"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-herehere" class="level3" data-number="11.1.2">
<h3 data-number="11.1.2" class="anchored" data-anchor-id="using-herehere"><span class="header-section-number">11.1.2</span> Using here::here()</h3>
<section id="a-brief-introduction-to-herehere" class="level4">
<h4 class="anchored" data-anchor-id="a-brief-introduction-to-herehere">A brief introduction to here::here()</h4>
<p>If you are using an RStudio project but used a different download method, or already have the file you want to process on your computer, or are using base R we can still use the here::here function, however we will have to find the file first. Best practise is to put the file in the same folder as this script, or in a folder within the project. If this is done, then use <code>here::here()</code> to find your current working directory, and then navigate to the file folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run this script to see where is your directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">here</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to navigate there, I have to include each subfolder between my <code>here::here</code> location and the file itself (so the ‘Research’ folder, the ‘FCT_cleaning’ folder and the ‘FCT_1’ folder). To do this, specify these folders in here::here, and then specify the file itself, like so: <code>here::here('Research', 'FCT_cleaning', 'FCT_1', 'The_actual_fct.xlsx')</code>. If using an RStudio project, and you put this .R file and the data file in the same folder as the RStudio project or within a subfolder, this is much easier as your project/here::here location automatically moves to the main project folder. More information about the here package can be found <a href="https://here.r-lib.org/">here</a>.</p>
</section>
<section id="using-herehere-1" class="level4">
<h4 class="anchored" data-anchor-id="using-herehere-1">Using here::here()</h4>
<p>Find your file in your computer, and then direct here::here to it - e.g.: (edit the line below to match your file location, remove hash from the start of the line below and run)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>FCT_file_location <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'Research'</span>, <span class="st">'FCT_cleaning'</span>, <span class="st">'FCT_1'</span>, <span class="st">'The_actual_fct.xlsx'</span>) <span class="co">#This identifies the file and file path, and saves it as a variable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="importing-files" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="importing-files"><span class="header-section-number">11.2</span> Importing Files</h2>
<p>During import, a identifier for the FCT is created and added to the table. Please replace ‘MW19’ from the next code chunck with the FCT id., comprised of the countries <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">ISO 3166 2-alpha code</a>, and the year the FCT was produced (e.g.&nbsp;for the Malawi FCT from 2019, the reference would be ‘MW19’). This should be the same as the folder name explained in (section 1.3)[link-to-section].</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is an example of the name </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>FCT_id <span class="ot">&lt;-</span> <span class="st">'MW19'</span> <span class="co"># Change two first letter for your ISO 2 code &amp; the two digits for the last two digits of the year of publication.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>FCT files come in many different forms - the most common being “.xlsx” files and “.csv” files. Methods to import both of these file types will be covered - please navigate to the relevant subsection.</p>
<section id="importing-.xlsx-files" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="importing-.xlsx-files"><span class="header-section-number">11.2.1</span> Importing .xlsx files</h3>
<p>For the excel-type of files, first, you need to check what information is provided and which of the sheet is providing the FC data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(FCT_file_location, <span class="co">#The file location, as                            identified in section 2.1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sheet =</span> <span class="dv">1</span>  <span class="co"># Change to the excel sheet where                              the FCT is stored in the excel file</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                              ) <span class="sc">%&gt;%</span>  </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source_fct =</span> FCT_ref)  <span class="co">#Creates the source_fct column and fills with                 a id for this FCT, as filled in in section 2.2. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-.csv-files" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="importing-.csv-files"><span class="header-section-number">11.2.2</span> Importing .csv files</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(FCT_file_location, <span class="co">#The file location, as identified in section 2.1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span>  <span class="co"># Replace w/ other symbol if needed</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source_fct =</span> FCT_ref) <span class="co">#Creates the source_fct column and fills with a id for this FCT, as filled in in section 2.2. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once imported, it is important to check the data.frame created from the csv, by using <code>head(data.df)</code> or clicking on its entry in the Environment panel of RStudio (This second option is not advised with very large files, however, as it can be slow).</p>
<p>If the data shown by doing this has all its columns combined, with a symbol in-between, then that symbol (e.g.&nbsp;‘;’) is the separator for that csv. Replace comma in the <code>sep = ","</code> line from the code block above with the # new symbol, and run the entire block again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the dataframe</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="checking-the-loaded-data" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="checking-the-loaded-data"><span class="header-section-number">11.3</span> Checking the loaded data</h2>
</section>
<section id="how-many-rows-columns-have-the-data" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="how-many-rows-columns-have-the-data"><span class="header-section-number">11.4</span> How many rows &amp; columns have the data?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data.df) <span class="co"># rows &amp; columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-are-the-variables-names" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="what-are-the-variables-names"><span class="header-section-number">11.5</span> What are the variables names?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we are happy that we have loaded the correct FCT file, then proceed. If not, find the correct file and import it instead.</p>
</section>
</section>
<section id="data-formatting" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Data Formatting</h1>
<section id="visually-checking-the-data" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="visually-checking-the-data"><span class="header-section-number">12.1</span> Visually checking the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the first rows and columns</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data.df) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the last rows and columns</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(data.df)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Opening the dataframe in a tab, </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Note: if the dataset is very very big, may crash the R session.</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(data.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="trimming-dataframe-rows" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="trimming-dataframe-rows"><span class="header-section-number">12.2</span> Trimming dataframe rows</h2>
<p>Running this will trim down the table to only include the row numbers between x and y - replace x and y with your desired values. If you wanted to include multiple row ranges, that is also possible - use comments to differentiate between different row ranges and individual rows. e.g.&nbsp;if you wanted to include rows a:b, row c, row e, and rows g:x, then the code would be <code>slice(a:b, c, e, g:x)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df <span class="sc">%&gt;%</span> <span class="fu">slice</span>(x<span class="sc">:</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./hcesNutR-package.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>hcesNutR</code> Package</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">summary.html</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>