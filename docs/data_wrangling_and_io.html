<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for Household Consumption and Expenditure Surveys - 4&nbsp; Data Import,Wrangling and Export</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data_structures.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Import,Wrangling and Export</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Household Consumption and Expenditure Surveys</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://dzvoti.github.io/hces4R/hces-datazip" title="" class="sidebar-tool px-1"><i class="bi bi-cloud-arrow-down"></i></a>
    <a href="https://github.com/dzvoti/mapsNutritionR/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_introR.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_types.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Structures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_wrangling_and_io.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Import,Wrangling and Export</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-import" id="toc-data-import" class="nav-link active" data-scroll-target="#data-import">Data Import</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data">Import the data</a></li>
  <li><a href="#subsetting-data" id="toc-subsetting-data" class="nav-link" data-scroll-target="#subsetting-data">Subsetting data</a></li>
  <li><a href="#subsetting-data-frames" id="toc-subsetting-data-frames" class="nav-link" data-scroll-target="#subsetting-data-frames">Subsetting data frames</a></li>
  <li><a href="#subsetting-columns" id="toc-subsetting-columns" class="nav-link" data-scroll-target="#subsetting-columns">Subsetting columns</a></li>
  <li><a href="#subsetting-rows" id="toc-subsetting-rows" class="nav-link" data-scroll-target="#subsetting-rows">Subsetting rows</a></li>
  </ul></li>
  <li><a href="#chaining-operations-using-the-pipe-operator" id="toc-chaining-operations-using-the-pipe-operator" class="nav-link" data-scroll-target="#chaining-operations-using-the-pipe-operator">Chaining operations using the pipe operator</a>
  <ul class="collapse">
  <li><a href="#change-the-data-type-of-a-column" id="toc-change-the-data-type-of-a-column" class="nav-link" data-scroll-target="#change-the-data-type-of-a-column">Change the data type of a column</a></li>
  <li><a href="#create-a-new-column" id="toc-create-a-new-column" class="nav-link" data-scroll-target="#create-a-new-column">Create a new column</a></li>
  <li><a href="#vectorised-operations" id="toc-vectorised-operations" class="nav-link" data-scroll-target="#vectorised-operations">Vectorised operations</a></li>
  <li><a href="#enriching-data" id="toc-enriching-data" class="nav-link" data-scroll-target="#enriching-data">Enriching data</a></li>
  <li><a href="#grouping-and-summarising-data" id="toc-grouping-and-summarising-data" class="nav-link" data-scroll-target="#grouping-and-summarising-data">Grouping and Summarising Data</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/dzvoti/mapsNutritionR/edit/main/data_wrangling_and_io.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Import,Wrangling and Export</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Up to this point we were creating data to manipulate in R. In this section we will learn how to import data into R, manipulate it and export it. We will use the <code>readr</code> and <code>haven</code> packages to import data into R, the <code>dplyr</code> package to manipulate data and the <code>readr</code> package to export data from R. We will also use the <code>here</code> package to manage file paths.</p>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data Import</h2>
<p>There are many ways to import data into R. In this section we will look at how to import data from a CSV file, an Excel file and Stata file. In the sample data folder there are <code>*.csv</code> files and stata files <code>*.dta</code>. Foe example to import the health data from a survey stored in <code>hh_mod_a_filt_vMAPS.dta</code> stored in the <code>mwi-ihs5-sample-data</code> folder within our working directory we run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the haven package</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import roster data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ihs5_roster <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"hh_mod_a_filt_vMAPS.dta"</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ihs5_roster )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  case_id      HHID                             region
  &lt;chr&gt;        &lt;chr&gt;                             &lt;dbl&gt;
1 201011000001 ee2d2915a43d589af42a8b88c279698d      3
2 201011000002 23d0a64bef9c68896ab464af581c47be      1
3 201011000003 c108a854e8e9bef3d5a7556ef051013c      3
4 201011000004 45e28358fd8627fdbe8ddf2dcf62659e      1
5 201011000005 4472919b195eb3d0dd527d2de706a6ce      1
6 201011000006 695def6a945f7f46a3bdbc28659861fc      3</code></pre>
</div>
</div>
<p>To read a csv file we use the <code>read_csv()</code> function from the <code>readr</code> package. For example, to import the <code>IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv</code> file stored in the <code>mwi-ihs5-sample-data</code> folder within our working directory we run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the readr package</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import unit conversion factors data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ihs5_unit_conversion_factors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 2391 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): food_item_name, unit_code, unit_name, measure_id
dbl (3): region, food_item_code, factor

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ihs5_unit_conversion_factors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  region food_item_name     food_item_code unit_code unit_name measure_id factor
   &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
1      1 MAIZE UFA MGAIWA …            101 97        BASIN     1-97-101    3.40 
2      2 MAIZE UFA MGAIWA …            101 97        BASIN     2-97-101    3.40 
3      3 MAIZE UFA MGAIWA …            101 97        BASIN     3-97-101    3.40 
4      3 MAIZE UFA MGAIWA …            101 84        CUP       3-84-101    0.445
5      3 MAIZE UFA MGAIWA …            101 82        3LITRE B… 3-82-101    2.33 
6      1 MAIZE UFA MGAIWA …            101 25        TINA      1-25-101    0.323</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Excercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Import your own excel file into R.</li>
</ol>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice how all import operations are done within the <code>here::here()</code> function. This is because we are using the <code>here</code> package to manage file paths. The <code>here::here()</code> function returns the path to the file relative to the working directory. This is useful when you want to share your code with others, as they can run the code without having to change the file paths.</p>
<p>It is very import that file names and directories are typed as they are. R is sensitive to capital letters and spaces. For example, if you type <code>IHS5_UNIT_CONVERSION_FACTORS_VMAPS.csv</code> instead of <code>IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv</code>, R will throw an error. To get around this in RStudio use the <code>tab</code> key to autocomplete file names and directories.</p>
</div>
</div>
<p>After importing files they are usually stored in memory as dataframes/tibbles. We can check the class of an object using the <code>class()</code> function. For example, to check the class of the <code>ihs5_roster</code> object, we would type <code>class(ihs5_roster)</code>. We can also check the structure of an object using the <code>str()</code> function. For example, to check the structure of the <code>ihs5_roster</code> object, we would type <code>str(ihs5_roster)</code>. We want to make sure that the data is imported correctly before we start manipulating it.</p>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h2>
<p>The <code>dplyr</code> package from the <code>tidyverse</code> package is our data wrangling tool of choice. It provides a set of functions for manipulating dataframes e.g.&nbsp;renaming columns, conditional removal of rows, creation of other columns and so on. We will load and manipulate the <code>consumption</code> module of our hypothetical Malawi IHS5 survey data. The data is stored in the <code>mwi-ihs5-sample-data</code> folder within our working directory and is called <code>HH_MOD_G1_vMAPS.dta</code>. We will use the <code>here</code> package to manage file paths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># data manipulation</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># data import</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># file paths</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="import-the-data" class="level3">
<h3 class="anchored" data-anchor-id="import-the-data">Import the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"HH_MOD_G1_vMAPS.dta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Excercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Check if the data improrted correctly</li>
<li>Check the structure of the data</li>
<li>How many observations and variables are there?</li>
</ol>
</div>
</div>
</section>
<section id="subsetting-data" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-data">Subsetting data</h3>
</section>
<section id="subsetting-data-frames" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-data-frames">Subsetting data frames</h3>
<p>There are a number of functions that can be used to extract subsets of R objects in tidyverse syntax. The most important are the following from the <code>dplyr</code> package:</p>
<ul>
<li>filter() allows you to select a subset of rows in a data frame.</li>
<li>select() allows you to select a subset of columns in a data frame.</li>
<li>arrange() allows you to reorder the rows of a data frame.</li>
<li>mutate() allows you to create new columns from existing columns.</li>
<li>summarise() allows you to collapse many values down to a single summary.</li>
<li>pull() allows you to extract a single column from a data frame as a vector.</li>
</ul>
</section>
<section id="subsetting-columns" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-columns">Subsetting columns</h3>
<p>This data that we loaded is a randomly generated immitation of the Malawi Intergrated Household Survey 2018-2019 described <a href="https://microdata.worldbank.org/index.php/catalog/3818/study-description">here</a>. This data contains responses on <code>total consumption</code> as well as disaggregation of the sources of these foods.In this book we will process only the `total consumption.</p>
<p>Remember we said that our data is loaded in memory? Seeing that the <code>ihs5_consumption</code> data contains columns we do not need let us subset it. The <code>select</code> function in dplyr is very useful for this. For example to keep only the columns with household identifiers and food names, units and quantity of consumption we keep the following columns in our data;“case_id”,“HHID”,“hh_g01”,“hh_g01_oth”,“hh_g02”,“hh_g03a”,“hh_g03b”,“hh_g03b_label”,“hh_g03b_oth”,“hh_g03c”,“hh_g03c_1”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption_subset <span class="ot">&lt;-</span> <span class="fu">select</span>(ihs5_consumption, case_id, HHID, hh_g01, hh_g01_oth, hh_g02, hh_g03a, hh_g03b, hh_g03b_label, hh_g03b_oth, hh_g03c, hh_g03c_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The syntax for most tidyverse functions is <code>function (data,columns)</code>. Notice that we stored the subsetting operation in a new object called <code>ihs5_consumption_subset</code>? This is generally frowned upon unless we intend to use the original dataset for separate operations. Storing the subset in a new object will use up more memory to store the 2 objects. We can overwrite the original object by typing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">select</span>(ihs5_consumption, case_id, HHID, hh_g01, hh_g01_oth, hh_g02, hh_g03a, hh_g03b, hh_g03b_label, hh_g03b_oth, hh_g03c, hh_g03c_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next let us give the columns more meaningful names. We can do this using the <code>rename</code> function. For example, to rename the <code>hh_g01</code> column to <code>consumedYN</code> and <code>hh_g02</code> to <code>food_item</code>, we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">rename</span>(ihs5_consumption, <span class="at">consumedYN =</span> hh_g01, <span class="at">food_item =</span> hh_g02)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how our operations only affect the specific columns we specify? This is because the <code>select</code> and <code>rename</code> functions are smart and intiutive.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Excercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Rename the remaining columns to: |old_name | new_name| |—|—| |hh_g01_oth | food_item_other| |hh_g03a | consumption_quantity| |hh_g03b | consumption_unit| |hh_g03b_label | consumption_unit_label| |hh_g03b_oth | consumption_unit_oth| |hh_g03c | consumption_subunit_1| |hh_g03c_1 |consumption_subunit_2|</li>
</ol>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Solution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload the data to start from scratch</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"HH_MOD_G1_vMAPS.dta"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">rename</span>(ihs5_consumption, <span class="at">consumedYN =</span> hh_g01, <span class="at">food_item =</span> hh_g02, <span class="at">food_item_other =</span> hh_g01_oth, <span class="at">consumption_quantity =</span> hh_g03a, <span class="at">consumption_unit =</span> hh_g03b, <span class="at">consumption_unit_label =</span> hh_g03b_label, <span class="at">consumption_unit_oth =</span> hh_g03b_oth, <span class="at">consumption_subunit_1 =</span> hh_g03c, <span class="at">consumption_subunit_2 =</span> hh_g03c_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="subsetting-rows" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-rows">Subsetting rows</h3>
<p>We can also subset rows using the <code>filter</code> function. For example, to keep only the rows where <code>consumedYN</code> is equal to <code>1</code>, we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">filter</span>(ihs5_consumption, consumedYN <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we are using the logical operator <code>==</code> to test each row whether the value of <code>consumedYN</code> is equal to <code>1</code>? This is called a conditional statement as we discussed in the previous sections.</p>
</section>
</section>
<section id="chaining-operations-using-the-pipe-operator" class="level2">
<h2 class="anchored" data-anchor-id="chaining-operations-using-the-pipe-operator">Chaining operations using the pipe operator</h2>
<p>We can chain operations using the pipe operator <code>%&gt;%</code> or <code>|&gt;</code>. This is useful when we want to perform multiple operations on a dataset. For example, to read, subset the data and rename the columns in one operation, we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read, subset and rename the data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"HH_MOD_G1_vMAPS.dta"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(case_id, HHID, hh_g01, hh_g01_oth, hh_g02, hh_g03a, hh_g03b, hh_g03b_label, hh_g03b_oth, hh_g03c, hh_g03c_1) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">consumedYN =</span> hh_g01, <span class="at">food_item =</span> hh_g02, <span class="at">food_item_other =</span> hh_g01_oth, <span class="at">consumption_quantity =</span> hh_g03a, <span class="at">consumption_unit =</span> hh_g03b, <span class="at">consumption_unit_label =</span> hh_g03b_label, <span class="at">consumption_unit_oth =</span> hh_g03b_oth, <span class="at">consumption_subunit_1 =</span> hh_g03c, <span class="at">consumption_subunit_2 =</span> hh_g03c_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We deliberately used both the pipe operators <code>%&gt;%</code> and <code>|&gt;</code> to show that they are the same. The %&gt;% is the most popular of the <code>tidyverse</code> pipes from the <code>magrittr</code> package. Recent versions (circa 2020) intoduced the native <code>R</code> pipe <code>|&gt;</code>. The pipe operator is useful when we want to perform multiple operations on a dataset without storing the intermediate results in memory. In the above example we only stored the final result in memory. This is useful when we are working with large datasets and want to save memory.</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>When chaining operations we do not need to specify the data argument in the subsequent functions. This is because the output of the previous function is passed to the next function. If we want to specify the data argument, we can use the <code>.</code> symbol. For example, to specify the data argument in the <code>rename</code> function, we would type:</p>
</div>
</div>
<section id="change-the-data-type-of-a-column" class="level3">
<h3 class="anchored" data-anchor-id="change-the-data-type-of-a-column">Change the data type of a column</h3>
<p>The <code>mutate</code> function is used to create new columns from existing columns. It is also used to change the data type of a column. For example, to change the data type of the <code>consumption_quantity</code> column to numeric, we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">food_item_code =</span> <span class="fu">as.character</span>(food_item))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-new-column" class="level3">
<h3 class="anchored" data-anchor-id="create-a-new-column">Create a new column</h3>
<p>As we mentioned earlier, the <code>mutate</code> function is used to create new columns from existing columns. For example, to create a new column with hh_members (randomly generated) we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hh_members =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">nrow</span>(ihs5_consumption), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are using the <code>sample</code> function to generate random numbers between 1 and 10. The <code>nrow</code> function returns the number of rows in the <code>ihs5_consumption</code> data. The <code>replace = TRUE</code> argument tells the <code>sample</code> function to sample with replacement. This means that the same number can be sampled more than once. If we want to sample without replacement we would type <code>replace = FALSE</code>.</p>
<p>We used the <code>sample</code> function a lot during the generation of the sample data used in this book. You can see more on this in the <a href="">data generation</a> section.</p>
</section>
<section id="vectorised-operations" class="level3">
<h3 class="anchored" data-anchor-id="vectorised-operations">Vectorised operations</h3>
<p>The <code>mutate</code> function is also useful for vectorised operations. For example, to create a new column with the consumption per person we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">consumption_per_person =</span> consumption_quantity <span class="sc">/</span> hh_members)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Excercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose this data is from a 7 day recall survey. Create a new column with the consumption per person per day.</p>
</div>
</div>
</section>
<section id="enriching-data" class="level3">
<h3 class="anchored" data-anchor-id="enriching-data">Enriching data</h3>
<p>We can enrich our data by joining different files using the <code>join</code> function. The most common joins are <code>left_join</code>, <code>right_join</code>, <code>inner_join</code> and <code>full_join</code>.</p>
<p>The <code>left_join</code> function joins two dataframes by keeping all the rows in the first dataframe and matching the rows in the second dataframe.</p>
<p>Most joining operations in hces data analysis are <code>left_join</code> operations as we want to keep all the rows in the primary data we are processing and <code>enrich</code> it with matched rows in the other data. For example, to join the <code>ihs5_consumption</code> data with the <code>ihs5_household_identifies</code> contained in <code>hh_mod_a_filt_vMAPS.dta</code> data we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ihs5_household_identifiers <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"hh_mod_a_filt_vMAPS.dta"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the data</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ihs5_consumption_j1 <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(ihs5_household_identifiers, <span class="at">by =</span> <span class="st">"HHID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is an enriched dataset with rows from the <code>ihs5_household_identifiers</code> data that match the <code>HHID</code> column in the <code>ihs5_consumption</code> data. The <code>by</code> argument tells the <code>left_join</code> function which column to use to match the rows. If the column names are the same in both dataframes, we do not need to specify the <code>by</code> argument. For example, to join the <code>ihs5_consumption</code> data with the <code>ihs5_household_identifies</code> contained in <code>hh_mod_a_filt_vMAPS.dta</code> data we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ihs5_household_identifiers <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"mwi-ihs5-sample-data"</span>, <span class="st">"hh_mod_a_filt_vMAPS.dta"</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the data</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(ihs5_household_identifiers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Excercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Compare the results of the two joins.</li>
<li>What is the difference?</li>
</ol>
</div>
</div>
</section>
<section id="grouping-and-summarising-data" class="level3">
<h3 class="anchored" data-anchor-id="grouping-and-summarising-data">Grouping and Summarising Data</h3>
<p>We can group data using the <code>group_by</code> function. Grouping data is useful when we want to summarise data. In <code>dplyr</code> the summaries are created from the <code>groups</code> in the data. For eample to summarise the <code>consumption_per_person</code> by <code>food_item</code> we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise the data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption_summary <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(food_item) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">consumption_per_person =</span> <span class="fu">mean</span>(consumption_per_person, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are using the <code>mean</code> function to calculate the mean of the <code>consumption_per_person</code> column. The <code>na.rm = TRUE</code> argument tells the <code>mean</code> function to ignore missing values.</p>
<p>We can also compute multiple summaries at once. For example, to compute the mean and standard deviation of the <code>consumption_per_person</code> column we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise the data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption_summary <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(food_item) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">consumption_per_person_mean =</span> <span class="fu">mean</span>(consumption_per_person, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">consumption_per_person_sd =</span> <span class="fu">sd</span>(consumption_per_person, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To compute summaries across multiple groups we can use the <code>group_by</code> function with multiple arguments. For example, to compute the mean and standard deviation of the <code>consumption_per_person</code> column by <code>food_item</code> and <code>region</code> we would type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise the data</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ihs5_consumption_summary <span class="ot">&lt;-</span> ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(food_item, region) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">consumption_per_person_mean =</span> <span class="fu">mean</span>(consumption_per_person, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">consumption_per_person_sd =</span> <span class="fu">sd</span>(consumption_per_person, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next section we will learn how to use plots to visualise our data. A basic example of a plot is a bar chart. For example we can visualise the consumption per person by food item using a bar chart. To do this we will use the <code>ggplot2</code> package from the <code>tidyverse</code> package like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the ggplot2 package</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  Plot the data</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ihs5_consumption <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add plot aesthetics</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> consumption_per_person,<span class="at">group=</span>region)) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add plot type</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we plotted a boxplot of the <code>consumption_per_person</code> by <code>region</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Data Export</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>We can export data from R using the <span class="st">`</span><span class="at">write_csv()</span><span class="st">`</span> <span class="cf">function</span> from the <span class="st">`</span><span class="at">readr</span><span class="st">`</span> package. For example, to export the <span class="st">`</span><span class="at">ihs5_consumption</span><span class="st">`</span> data to a csv file called <span class="st">`</span><span class="at">ihs5_consumption.csv</span><span class="st">`</span> stored <span class="cf">in</span> our working directory we run<span class="sc">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(ihs5_consumption, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"ihs5_consumption.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We recommend exporting files to csv as this allows interoperability between various software. If you prefer exporting your data to excel, you can use the <code>write_xlsx()</code> function from the <code>writexl</code> package. For example, to export the <code>ihs5_consumption</code> data to an excel file called <code>ihs5_consumption.xlsx</code> stored in our working directory we run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(ihs5_consumption, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"ihs5_consumption.xlsx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To export the data to a stata file, we can use the <code>write_dta()</code> function from the <code>haven</code> package. For example, to export the <code>ihs5_consumption</code> data to a stata file called <code>ihs5_consumption.dta</code> stored in our working directory we run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_dta</span>(ihs5_consumption, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"ihs5_consumption.dta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data_structures.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Structures</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>